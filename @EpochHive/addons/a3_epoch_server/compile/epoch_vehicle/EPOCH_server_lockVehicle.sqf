private["_aa","_ab"];_aa=_this select 0;_player=_this select 2;if(isNull _aa)exitWith{};if !([_player,_this select 3]call EPOCH_server_getPToken)exitWith{};if(_player distance _aa > 20)exitWith{};_plyrUID=getPlayerUID _player;_plyrGroup=_player getVariable["GROUP",""];_lockOwner=_plyrUID;if(_plyrGroup !="")then{_lockOwner=_plyrGroup;};_lockedOwner="-1";_vehSlot=_aa getVariable["VEHICLE_SLOT","ABORT"];_vehLockHiveKey=format["%1:%2",(call EPOCH_fn_InstanceID),_vehSlot];if(_vehSlot !="ABORT")then{_response=["VehicleLock",_vehLockHiveKey]call EPOCH_server_hiveGETRANGE;if((_response select 0)==1 && typeName(_response select 1)=="ARRAY" && !((_response select 1)isEqualTo[]))then{_lockedOwner=_response select 1 select 0;};};_isLocked=locked _aa in[2,3];if(!_isLocked || _lockedOwner==_lockOwner || _lockedOwner=="-1")then{_ab=_this select 1;if(_ab)then{["VehicleLock",_vehLockHiveKey,EPOCH_vehicleLockTime,[_lockOwner]]call EPOCH_server_hiveSETEX;};if(local _aa)then{_aa lock _ab;}else{if(_ab)then{[["lockVehicle",_aa],(owner _aa)]call EPOCH_sendPublicVariableClient;}else{[["unlockVehicle",_aa],(owner _aa)]call EPOCH_sendPublicVariableClient;};};};