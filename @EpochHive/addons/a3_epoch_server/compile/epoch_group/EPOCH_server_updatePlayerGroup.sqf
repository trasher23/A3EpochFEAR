private["_aa","_ab","_ac","_ad","_ae","_af","_ag","_ah","_ai","_aj","_ak","_al","_am","_an"];if !([_this select 4,_this select 5]call EPOCH_server_getPToken)exitWith{};_aa=_this select 0;if(_aa=="")exitWith{diag_log format["GROUP: No Group Selected %1",_this];};diag_log format["GROUP: Update %1",_this];_ab=_this select 1;_ac=_this select 2;_ad=if(_this select 3)then[{3},{4}];_ae=if(_this select 3)then[{4},{3}];_af=["Group",_aa]call EPOCH_server_hiveGETRANGE;if((_af select 0)==1 && typeName(_af select 1)=="ARRAY")then{_ag=_af select 1;_ah=_ag select 3;_ai=_ag select 4;if(_ac)then{_aj="Dead Player";{if(getPlayerUID _x==_ab)exitWith{_aj=if(alive _x)then{name _x};if((_x getVariable["GROUP",""])!=_aa)then{_x setVariable["GROUP",_aa];_ak=grpNull;{if((_x getVariable["GROUP",""])==_aa)exitWith{_ak=group _x;};}count playableUnits;if(isNull _ak)then{_ak=createGroup west;};[_x]joinSilent _ak;};};}count playableUnits;_al=_ag select _ae;{if(_x select 0==_ab)exitWith{_al deleteAt _forEachIndex;_ag set[_ae,_al];};}forEach _al;_am=_ag select _ad;_am pushBack[_ab,_aj];_ag set[_ad,_am];}else{_an=false;{if(getPlayerUID _x==_ab)exitWith{_x setVariable["GROUP",nil];[_x]joinSilent(createGroup west);[["resetGroup",true],(owner _x)]call EPOCH_sendPublicVariableClient;};}count playableUnits;{if(_x select 0==_ab)exitWith{_ai deleteAt _forEachIndex;_an=true;};}forEach _ai;if(_an)then{_ag set[4,_ai];}else{{if(_x select 0==_ab)exitWith{_ah deleteAt _forEachIndex;_an=true;};}forEach _ah;_ag set[3,_ah];};if(!_an)then{diag_log format["%1 cannot remove Player! (%1)",__FILE__,_this]};};{if((_x getVariable["GROUP",""])==_aa)exitWith{{[["groupUpdate",_ag],(owner _x)]call EPOCH_sendPublicVariableClient;}count(units group _x);};}count playableUnits;["Group",_aa,_ag]call EPOCH_server_hiveSET;};